# ESG 报告自动化多代理工作流设计

该工作流围绕上交所《可持续发展报告披露指引与编写指南》与 GRI 标准构建，目标是以“策略规划 → 分析评估 → 过程文件 → 报告生成”的路径完成 ESG 报告草案与配套材料的自动化生成。系统采用多智能体（Multi-Agent）协作模式，每个智能体负责特定的信息抽取与内容生成任务，同时共享统一的数据上下文。整体逻辑如下：

1. **StakeholderAnalysisAgent**
   - **目标**：识别企业在报告编制过程中需要重点沟通的利益相关方，覆盖监管、投资者、员工、供应链、客户、社区等群体。
   - **方法**：结合输入行业、地域及企业概况，自动生成期望诉求、沟通渠道与优先级列表。输出结果满足指引中对“利益相关方识别与沟通机制”章节的披露要求（SSE 4.2, GRI 3-1）。
   - **产出**：`Stakeholder` 数据对象集合，可用于后续重要性分析与报告章节撰写。

2. **MaterialityMatrixAgent**
   - **目标**：依据利益相关方的关注重点与企业经营影响，计算议题的重要性并生成矩阵分布。
   - **方法**：以行业情境为基准，引用与SSE/GRI对应条款的议题模板，输出每个议题的影响分、重要性分、关联标准，形成“高影响 / 高重要”等象限分类。
   - **产出**：`MaterialityMatrix` 对象，用于绘制重要性矩阵与披露决策依据。

3. **PolicyBenchmarkAgent**
   - **目标**：针对关键议题比对现有内部政策与外部指南之间的差距。
   - **方法**：自动遍历重要议题，映射到上交所披露指引与 GRI 标准的章节，生成政策覆盖评估与改进建议，满足监管强调的“过程性文件”存档要求。
   - **产出**：`ProcessDocument`（政策对标清单），归档并可下载。

4. **PeerBenchmarkAgent**
   - **目标**：从行业视角输出同业最佳实践参考，支持“对标先进”的过程文件。
   - **方法**：结合默认行业案例或用户输入的对标企业，提炼披露亮点、指标类型和可借鉴方式。
   - **产出**：`ProcessDocument`（同业对标分析），支持档案下载。

5. **ReportCompilerAgent**
   - **目标**：汇总前述分析结果，结构化生成符合SSE披露章节逻辑的报告草案，涵盖治理、利益相关方、重要性议题、政策/同业对标与行动计划等核心内容。
   - **方法**：在统一上下文中自动编排文本，并记录所有过程性文件的索引，方便查阅与审计。
   - **产出**：完整的报告草案文本以及包含所有中间文件的 `ESGReportPackage`。

## 用户交互与档案管理

- 用户通过 Web UI 输入企业概况、同业名称及关注点等基础信息，触发工作流运行。
- 生成的成果包含：利益相关方分析、重要性议题矩阵、政策对标清单、同业对标分析、报告草案。
- 所有成果会被自动归档至 `storage/archives`，用户可在界面中查看历史记录并下载 DOCX 文件，满足过程文件留痕要求。
- 审阅界面支持用户对关键章节进行确认或提出补充意见，系统会将确认记录生成新的过程文档一并归档。

## 扩展与治理控制

- 工作流可扩展更多智能体，如“定量指标采集”“风险机遇分析”等。
- `ESGWorkflow.debug_trace()` 提供流程追踪，便于内部审计或自定义编排。
- 所有模型结构使用 Pydantic 进行数据校验，保证记录格式一致并便于对接外部系统。
